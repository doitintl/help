---
sidebar_position: 2
description: How to set up and implement Spot Scaling recommendations
---

# Setting up Spot Scaling

## Connect your AWS account

To use Spot Scaling, you must provide access to your AWS account to the CMP.

If your account is not linked already, follow the instructions of [linking your AWS account](https://help.doit-intl.com/amazon-web-services/add-your-amazon-web-services-iam-role).

You also need to create an AWS IAM role and attach an IAM Policy with a requisite set of permissions. These permissions allow Spot Scaling to monitor your ASG behavior and make spot instance recommendations; they also allow you to implement the recommendations. Refer to [creating new policies: Spot Scaling](https://help.doit-intl.com/amazon-web-services/add-your-amazon-web-services-iam-role#spot-scaling) for details about the requisite permissions.

### Add Spot Scaling to your account

Once the account is linked, you need to update the role attached to your account with additional permissions for Spot Scaling by [adding a feature](https://help.doit-intl.com/amazon-web-services/add-your-amazon-web-services-iam-role#adding-a-feature).

Make sure to select the checkbox of **Spot Scaling**, as shown below.

![A screenshot showing the checkbox next to Spot Scaling](../assets/png/cmp-spot-scaling-checkbox.png)

## Spot Scaling Recommendations via CMP

You can check the recommendations, modify them as needed, and apply the recommendations in the CMP.

### View Recommendations

Open the Spot Scaling page under **Savings** in the top navigation.

Auto Scaling Groups (ASGs) associated with the linked AWS account will appear on your Spot Scaling page. ASGs not optimized will have a value of `Not Optimized` under the **Optimization Status** column.

![A screenshot showing the location of the 'Not Optimized' status](../assets/png/cmp-spot-scaling-not-optimized.png)

Click an ASG to view its Spot Scaling recommendations.

![A screenshot showing the location of the ASG name](../assets/png/cmp-spot-scaling-asg.png)

### Modify Recommendations

For an un-optimized ASG, you'll see the following:

- **Current Values**: the ASG's current configuration
- **Recommended Values**: Spot Scaling's recommendations

You'll also find the current on-demand costs and hours running for that ASG in the upper-left corner

![A screenshot showing the location of the Current Values and Recommended Values sections](../assets/png/cmp-current-values-recommended-values.png)

You can adjust the recommendations to your needs. You may modify the following values:

- On-Demand Base Capacity
- On-Demand Instances
- Spot Instances
- Allowed Instance Types
- Availability Zones

To edit the values of **Allowed Instance Types** and **Availability Zones**, click the corresponding **EDIT** button. Click **UPDATE** when you've made your changes.

### Apply Recommendations

To reconfigure your ASG according to Spot Scaling's recommendations, click **APPLY RECOMMENDATIONS**.

Once you've applied the recommendation, the **Recommended Values** column will disappear, the values under the **Current Values** column will be updated to reflect the changes, and the metrics displayed at the top will show the actual cost/hour breakdowns for on-demand and Spot, as well as the actual savings.

You can adjust the time range for which the metrics are displayed by clicking the **Time Range** dropdown in the upper-right corner.

After applying the recommendation, your ASG will have a value of `Optimized` under the **Optimization Status** column.

### General Settings

Spot Scaling provides two optional features:

- **Keep my ASG up to date**: If selected, Spot Scaling will automatically update the ASG's configuration to continuously maximize system runtime and spot-related EC2 savings.
- **Fallback to On-Demand**: If selected, when there are not enough EC2 instances available to meet the capacity demand for Spot instances, Spot Scaling will automatically fall back to on-demand instances.

## Spot Scaling auto-enrollment

Spot Scaling auto-enrollment is a tool-agnostic solution that allows you to implement Spot Scaling recommendations using Infrastructure as Code (IaC) tools, for example, Terraform and AWS CloudFormation, instead of having to log in to the CMP.

Spot Scaling auto-enrollment is ideal for DevOps or Platforms teams who prefer using IaC tools to deploy and maintain their cloud infrastructure.

### Enable Spot Scaling auto-enrollment via AWS ASG tags

Spot Scaling auto-enrollment leverages AWS ASG tags.

To enable auto-enrollment, use the following tags when creating your ASGs:

- tag to apply Spot Scaling recommendations:

  - **Key**: `doitintl:spotscaling:auto-enroll`
  - **Value**:
    - `Always`: Allows Spot Scaling to apply continuous recommendations by finding new savings opportunities when AWS modifies/updates their pricing for the spot market or when new resources are updated or released.
    - `Never`: Stops Spot Scaling from applying recommendations.

- tag to enable fallback to on-demand:
  - **Key**: `doitintl:fallback-to-on-demand`
  - **Value**:
    - `True`: When there are not enough EC2 instances available to meet the capacity demand for Spot instances, Spot Scaling will automatically fall back to on-demand instances.
    - `False`: Spot Scaling will not fall back to on-demand instances in case of [Spot Instance interruptions](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-interruptions.html).

:::info

The current implementation of auto-enrollment only allows the two tags mentioned above. Recommendations will be made based on 20% of desired capacity exists on-demand and 80% with spot instances. For the allowed instance type, the recommendations are similar machine types based on vCPUs and memory configuration.

To adjust the recommendations, you need to log in to the CMP to [Modify Recommendations](#modify-recommendations).
:::
