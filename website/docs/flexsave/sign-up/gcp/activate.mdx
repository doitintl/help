---
sidebar_position: 2
---

# Activate Flexsave

There are three steps in activating Flexsave:

1. [Provide payment information](#provide-payment-information)
2. [Confirm Flexsave Agreement](#confirm-flexsave-agreement)
3. [Activate Flexsave for GCP](#activate-flexsave-for-gcp)

## Provide payment information

To activate Flexsave for GCP, you first need to set up your billing:

1. Provide the payment information as indicated on the page, including:

   - **Billing address**: Billing address of your organization.
   - **Company details**: Company name and registration number (Tax ID).
   - **Contact details**: Accounts payable details.
   - **Payments**: Payment method and currency.

2. Select **CONFIRM PAYMENT INFORMATION** to create your billing profile.

3. Once the billing profile is created, you'll be taken to the following screen:

   <picture
     img={require('../../../assets/png/gcp-flexsave-landing-billing-done.png')}
     alt="Flexsave GCP landing page after creating billing profile"
   />

   Where you can:

   - Select the **VIEW** button to check your payment information.
   - Select the **SET UP FLEXSAVE** button to continue the activation process.

## Confirm Flexsave Agreement

To proceed with Flexsave activation, make sure you read the DoiT International Flexsave Agreement, select the checkboxes at the bottom of the agreement, and confirm the agreement.

## Activate Flexsave for GCP

Perform the following tasks to complete the activation:

1. Enable discount sharing from the Google Cloud console, and then select the corresponding checkbox to confirm.

   :::note

   By default, committed use discounts are applied at the project level. Flexsave works by attaching projects with CUDs to your Cloud Billing account. For Flexsave to be able to share the discount with your own projects, you need to [turn on committed use discount sharing](https://cloud.google.com/compute/docs/instances/signing-up-committed-use-discounts#turning_on_committed_use_discount_sharing).

   :::

1. Provide the location of your billing data, including:

   - **Organization ID**: See Google Cloud Docs for [Getting your organization ID](https://cloud.google.com/resource-manager/docs/creating-managing-organization#retrieving_your_organization_id).
   - **Project ID containing your BQ billing data**: See [Identifying projects](https://cloud.google.com/resource-manager/docs/creating-managing-projects#identifying_projects).
   - **Dataset ID containing your BQ billing data**: See [Getting dataset information](https://cloud.google.com/bigquery/docs/dataset-metadata#getting_dataset_information). The dataset name is also referred to as the dataset ID.
   - **Table ID containing your BQ billing data**: See [Get table information](https://cloud.google.com/bigquery/docs/tables#get_table_information). The table name is also referred to as the table ID.

   The code snippets will be updated automatically once the relevant information is provided.

1. Open the Google Cloud Shell, copy the command code snippets and run them in sequence in the shell.

   1. Grant DoiT service account BigQuery `Data Viewer` role on the dataset that contains your billing data.

      ```bash
      bq show --format=prettyjson $DATASET_ID | jq '.access = .access + [{"role": "READER", "userByEmail": "$DoiT_service_account_email"}]' > permissions.json

      bq update --source permissions.json $DATASET_ID
      ```

   1. Grant DoiT service account permission to attach projects with optimal CUDs to your Cloud Billing account.

      ```bash
      gcloud iam roles update doit_flexsave_role --organization=$ORG_ID --title="DoiT Flexsave Role" --stage=GA --add-permissions=billing.accounts.get,bigquery.jobs.create,billing.resourceAssociations.create,resourcemanager.projects.createBillingAssignment
      ```

      The command above updates the `DoiT Flexsave Role`, which was created when [setting up your estimate](get-estimate.mdx#set-up-your-estimate) and is associated with the DoiT service account, to add the following permissions:

      - `billing.accounts.get`: Allows to fetch your billing account name.
      - `bigquery.jobs.create`: Allows to import your billing tables.
      - `billing.resourceAssociations.create`, `resourcemanager.projects.createBillingAssignment`: Allows to attach projects to your billing account.

1. Select **ACTIVATE FLEXSAVE**.

Once activated, Flexsave will start processing your information and building an optimization plan. The whole process may take up to 24 hours. You'll be notified by email when it's completed.
