.. _google-cloud_upload-historical-gcp-billing-data:

Backfill Historical Billing Data
================================

.. epigraph::

   How to analyze cloud spend that pre-dates when you started using the CMP

Overview
--------

This feature enables you to upload all your historical Google Cloud billing data into DoiT Cloud Management Platform (CMP) to immediately analyze your cloud spend and promptly identify optimization opportunities through Cloud Analytics, BigQuery Lens, and other CMP features.

To get started, first, you need to ensure that you have a Service Account that connects your Google Cloud Organization to CMP. Then, you'll have to grant two additional required permissions.

Step 1. Identify the service account linked to CMP
--------------------------------------------------

#. From CMP's left side navigation menu, click "**Settings**"
#. Select "**Google Cloud**" tab
#. Locate the "**Service Account**" listed in Configured Accounts

.. image:: ../_assets/image\ (103).png
   :alt: A screenshot showing you how to identify the linked service accounts

If you do not have this configured yet, you need to create a service account and connect CMP to your Google Cloud Organization. Follow the steps in this link: `Connect Google Cloud Service Account <https://help.doit-intl.com/google-cloud/connect-google-cloud-service-account>`__

Once you have identified the service account, copy the service account email and proceed to granting it with the the additional required permissions.

Step 2. Grant the required Permissions
--------------------------------------

.. IMPORTANT::

   You need to have the appropriate IAM role/permission in GCP to grant the required permissions to the service account

.. Grant the **BigQuery Data Viewer role
   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

#. From GCP, navigate to the BigQuery Console and open the **dataset** where the billing data is stored, then click  "**Share dataset**"
#. In the Dataset Permissions tab, click "**Add Member**" and paste the **service account** **email** that was linked to CMP as identified in **Step 1**.
#. Click "**Select a Role**" highlight BigQuery then choose **BigQuery Data Viewer**
#. Click "**Add**"
#. Click "**Done**"

.. image:: ../_assets/image\ (96).png
   :alt: A screenshot showing you the location of the _Share Dataset_ button

.. image:: ../_assets/image\ (94).png
   :alt: A screenshot showing you how to grant the _BigQuery Data Viewer_ role

Step 3. Link your Google Cloud Direct Billing Account
-----------------------------------------------------

.. IMPORTANT::

   Required Permission: CMP Assets Manager or CMP Admin?

#. From CMP's left side navigation menu, click "**Assets**"
#. Select "**Google Cloud**" tab
#. Click the dropdown button next to "New Billing Account" and select "**Link Direct Account**"

.. image:: ../_assets/image\ (107).png
   :alt: A screenshot showing you how to link your _Google Cloud Direct Billing_ account

You can now import your historical billing data into CMP. You need the following information to complete the process:

* Billing Account ID: *example*  "**01CF51-9FDB87-7894FD**"
* Source Project: Enter the "**Project ID"**
* Source Dataset: Enter the "**Dataset ID"**

.. image:: ../_assets/image\ (119).png
   :alt: A screenshot showing you the _Link your Google Cloud Direct Billing Account_ form

Once you click "**Import**" a new card will be added to your assets reflecting the details and progress or completion status.

.. image:: ../_assets/image\ (115).png
   :alt: A screenshot showing you the new asset loading card

.. image:: ../_assets/image\ (118).png
   :alt: A screenshot showing you the _Create Google Billing Account_ modal dialog
